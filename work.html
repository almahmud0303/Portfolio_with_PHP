<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work Portfolio - Abdullah Al Mahmud</title>
    <link rel="stylesheet" href="css/style.css">
    <base href="/portfolio_test2/Mahmud_portfolio/">
    <style>
        .work-container { max-width: 1100px; margin: 24px auto 60px auto; padding: 0 16px; }
        .work-header { text-align: center; margin-bottom: 18px; }
        .work-header h2 { color: #ffb347; margin: 0 0 8px 0; }
        .controls { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin: 14px 0 22px 0; }
        .filter-btn { background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.14); color: #fff; padding: 8px 12px; border-radius: 10px; cursor: pointer; transition: all .2s; }
        .filter-btn.active, .filter-btn:hover { background: linear-gradient(135deg, #6a11cb, #ffb347); border-color: transparent; }
        .searchbox { max-width: 460px; margin: 0 auto; position: relative; }
        .searchbox input { width: 100%; padding: 12px 14px 12px 38px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.14); background: rgba(255,255,255,0.06); color: #e0e0e0; }
        .searchbox i { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #ffb347; }

        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px; }
        .card { background: rgba(34,34,34,0.98); border: 1px solid rgba(255,255,255,0.08); border-radius: 14px; overflow: hidden; transition: transform .2s, box-shadow .2s, border-color .2s; cursor: pointer; }
        .card:hover { transform: translateY(-6px); box-shadow: 0 14px 28px rgba(0,0,0,0.3); border-color: rgba(255,179,71,0.28); }
        .thumb { height: 150px; background-size: cover; background-position: center; }
        .content { padding: 14px; }
        .title { color: #ffb347; margin: 0 0 6px 0; font-size: 1.05rem; }
        .desc { margin: 0 0 10px 0; opacity: .85; font-size: .95rem; }
        .tags { display: flex; flex-wrap: wrap; gap: 6px; }
        .tag { font-size: .78rem; padding: 4px 8px; border-radius: 10px; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12); color: #e0e0e0; }

        .load-more { display: block; margin: 22px auto 0 auto; padding: 10px 16px; border-radius: 12px; border: none; cursor: pointer; font-weight: 700; color: #fff; background: linear-gradient(135deg, #6a11cb, #ffb347); }

        /* Modal */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 9999; align-items: center; justify-content: center; padding: 16px; }
        .modal-box { background: #232526; color: #fff; max-width: 760px; width: 100%; border-radius: 14px; box-shadow: 0 10px 30px rgba(0,0,0,0.35); overflow: hidden; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-bottom: 1px solid rgba(255,255,255,0.08); }
        .modal-header h3 { margin: 0; color: #ffb347; }
        .modal-close { cursor: pointer; color: #ffb347; font-size: 1.3rem; }
        .modal-body { padding: 16px; display: grid; grid-template-columns: 1fr; gap: 12px; }
        .modal-actions { display: flex; gap: 10px; padding: 0 16px 16px 16px; }
        .btn { background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.14); color: #fff; padding: 8px 12px; border-radius: 10px; text-decoration: none; }
        .btn.primary { background: linear-gradient(135deg, #6a11cb, #ffb347); border-color: transparent; }

        /* Animations */
        .fade-in { opacity: 0; transform: translateY(16px); animation: fadeInUp .6s ease forwards; }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
        
        /* Responsive Design */
        @media (max-width: 540px){ 
            .modal-body { grid-template-columns: 1fr; }
            .controls { flex-direction: column; align-items: center; }
            .searchbox { max-width: 100%; }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <a href="home.html" class="logo">AAM</a>
            <ul>
                <li><a href="home.html">Home</a></li>
                <li><a href="home.html#about">About</a></li>
                <li><a href="skill.html">Skills</a></li>
                <li><a href="education.html">Education</a></li>
                <li><a href="experience.html">Experience</a></li>
                <li><a href="work.html" class="active">Work</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
            <div class="mobile-menu-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </nav>
    </header>
    <main>
        <section class="work-container" id="portfolio">
            <div class="work-header">
                <h2>Projects</h2>
                <p>Browse projects by category or search by keyword.</p>
                <div id="project-count" style="margin-top: 10px; color: #e0e0e0; font-size: 0.9rem;"></div>
            </div>

            <div class="controls">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="frontend">Frontend</button>
                <button class="filter-btn" data-filter="backend">Backend</button>
                <button class="filter-btn" data-filter="fullstack">Fullstack</button>
                <button class="filter-btn" data-filter="uiux">UI/UX</button>
            </div>

            <div class="searchbox">
                <i class="fas fa-search"></i>
                <input id="project-search" type="text" placeholder="Search projects, tech or keywords" />
            </div>

            <div class="grid" id="project-grid">
                <!-- Cards will be injected by JS -->
            </div>
            <button id="load-more" class="load-more">Load More</button>
        </section>
    </main>
    <footer>
        <p>&copy; 2023 Abdullah Al Mahmud. All rights reserved.</p>
    </footer>
    <div id="project-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="modal-box">
            <div class="modal-header">
                <h3 id="modal-title"></h3>
                <span id="modal-close" class="modal-close">&times;</span>
            </div>
            <div class="modal-body">
                <div id="modal-image" style="height:220px;background:#1f2021;border-radius:10px;background-size:cover;background-position:center;"></div>
                <p id="modal-desc"></p>
                <div id="modal-tags" class="tags"></div>
            </div>
            <div class="modal-actions">
                <a id="modal-live" class="btn primary" href="#" target="_blank">Live Demo</a>
                <a id="modal-code" class="btn" href="#" target="_blank">Source Code</a>
            </div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js" defer></script>
    <script src="js/database-loader.js"></script>
    <script>
        // Updated work page with database integration

        const gridEl = document.getElementById('project-grid');
        const filterEls = document.querySelectorAll('.filter-btn');
        const searchEl = document.getElementById('project-search');
        const loadMoreBtn = document.getElementById('load-more');

        let currentFilter = 'all';
        let currentQuery = '';
        let currentOffset = 0;
        const limit = 6;

        // Initialize data loader
        const dataLoader = new PortfolioDataLoader();

        async function renderGrid() {
            try {
                // Show loading state
                if (currentOffset === 0) {
                    gridEl.innerHTML = '<div style="text-align: center; padding: 40px; color: #ffb347;">Loading projects...</div>';
                }
                
                const projectsData = await dataLoader.loadProjects(currentFilter, currentQuery, limit, currentOffset);
                const projects = projectsData.data;
                
                if (currentOffset === 0) {
                    gridEl.innerHTML = '';
                }
                
                if (projects.length === 0) {
                    if (currentOffset === 0) {
                        gridEl.innerHTML = '<div style="text-align: center; padding: 40px; color: #e0e0e0;">No projects found. Try adjusting your search or filters.</div>';
                    }
                    loadMoreBtn.style.display = 'none';
                    return;
                }
                
                projects.forEach(project => {
                    const card = createCard(project);
                    gridEl.appendChild(card);
                });
                
                // Update load more button
                loadMoreBtn.style.display = projectsData.pagination.has_more ? 'block' : 'none';
                
                // Update project count
                const countElement = document.getElementById('project-count');
                if (countElement) {
                    const total = projectsData.pagination.total;
                    const showing = Math.min(currentOffset + projects.length, total);
                    countElement.textContent = `Showing ${showing} of ${total} projects`;
                }
            } catch (error) {
                console.error('Error rendering projects:', error);
                if (currentOffset === 0) {
                    gridEl.innerHTML = '<div style="text-align: center; padding: 40px; color: #ff6f61;">Error loading projects. Please try again later.</div>';
                }
                loadMoreBtn.style.display = 'none';
            }
        }

        function createCard(project) {
            const card = document.createElement('div');
            card.className = 'card fade-in';
            card.setAttribute('data-category', project.category);
            card.innerHTML = `
                <div class="thumb" style="background-image:url('${project.image_url || 'img/default-project.jpg'}')"></div>
                <div class="content">
                    <h4 class="title">${project.title}</h4>
                    <p class="desc">${project.description}</p>
                    <div class="tags">
                        ${project.technologies.map(t => `<span class="tag">${t}</span>`).join('')}
                    </div>
                </div>
            `;
            card.addEventListener('click', () => openModal(project));
            return card;
        }

        // Filter functionality
        filterEls.forEach(btn => btn.addEventListener('click', () => {
            filterEls.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentFilter = btn.getAttribute('data-filter');
            currentOffset = 0; // reset pagination
            renderGrid();
        }));

        // Search functionality with debouncing
        let searchTimeout;
        searchEl.addEventListener('input', () => {
            currentQuery = searchEl.value;
            currentOffset = 0; // reset pagination
            
            // Clear previous timeout
            clearTimeout(searchTimeout);
            
            // Debounce search to avoid too many API calls
            searchTimeout = setTimeout(() => {
                renderGrid();
            }, 300);
        });

        // Load more functionality
        loadMoreBtn.addEventListener('click', async () => {
            loadMoreBtn.textContent = 'Loading...';
            loadMoreBtn.disabled = true;
            
            currentOffset += limit;
            await renderGrid();
            
            loadMoreBtn.textContent = 'Load More';
            loadMoreBtn.disabled = false;
        });

        // Modal logic
        const modal = document.getElementById('project-modal');
        const modalClose = document.getElementById('modal-close');
        const modalTitle = document.getElementById('modal-title');
        const modalImage = document.getElementById('modal-image');
        const modalDesc = document.getElementById('modal-desc');
        const modalTags = document.getElementById('modal-tags');
        const modalLive = document.getElementById('modal-live');
        const modalCode = document.getElementById('modal-code');

        function openModal(project) {
            modalTitle.textContent = project.title;
            modalImage.style.backgroundImage = `url('${project.image_url || 'img/default-project.jpg'}')`;
            modalDesc.textContent = project.description;
            modalTags.innerHTML = project.technologies.map(t => `<span class='tag'>${t}</span>`).join('');
            modalLive.href = project.live_url || '#';
            modalCode.href = project.source_code_url || '#';
            modal.style.display = 'flex';
        }

        function closeModal() { 
            modal.style.display = 'none'; 
        }

        modalClose.addEventListener('click', closeModal);
        modal.addEventListener('click', (e) => { 
            if(e.target === modal) closeModal(); 
        });

        // Keyboard navigation support
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
            // Enter key on search input
            if (e.key === 'Enter' && document.activeElement === searchEl) {
                renderGrid();
            }
        });

        // Show initial loading state
        gridEl.innerHTML = '<div style="text-align: center; padding: 40px; color: #ffb347;">Loading projects...</div>';
        
        // Initial render
        renderGrid();
    </script>
</body>
</html>